// Code generated by protoc-gen-go-orb. DO NOT EDIT.
//
// version:
// - protoc-gen-go-orb        v0.0.1
// - protoc                   v5.29.2
//
// Proto source: echo/echo.proto

package echo

import (
	"context"

	"github.com/go-orb/go-orb/client"
	"github.com/go-orb/go-orb/log"
	"github.com/go-orb/go-orb/server"

	grpc "google.golang.org/grpc"

	mdrpc "github.com/go-orb/plugins/server/drpc"
	memory "github.com/go-orb/plugins/server/memory"

	mhttp "github.com/go-orb/plugins/server/http"
)

// HandlerEcho is the name of a service, it's here to static type/reference.
const HandlerEcho = "echo.Echo"
const EndpointEchoEcho = "/echo.Echo/Echo"

// EchoClient is the client for echo.Echo
type EchoClient struct {
	client client.Client
}

// NewEchoClient creates a new client for echo.Echo
func NewEchoClient(client client.Client) *EchoClient {
	return &EchoClient{client: client}
}

// Echo requests Echo.
func (c *EchoClient) Echo(ctx context.Context, service string, req *Req, opts ...client.CallOption) (*Resp, error) {
	return client.Request[Resp](ctx, c.client, service, EndpointEchoEcho, req, opts...)
}

// EchoHandler is the Handler for echo.Echo
type EchoHandler interface {
	Echo(ctx context.Context, req *Req) (*Resp, error)
}

// registerEchoDRPCHandler registers the service to an dRPC server.
func registerEchoDRPCHandler(srv *mdrpc.Server, handler EchoHandler) error {
	desc := DRPCEchoDescription{}

	// Register with the server/drpc(.Mux).
	err := srv.Router().Register(handler, desc)
	if err != nil {
		return err
	}

	// Add each endpoint name of this handler to the orb drpc server.
	srv.AddEndpoint("/echo.Echo/Echo")

	return nil
}

// registerEchoMemoryHandler registers the service to an dRPC server.
func registerEchoMemoryHandler(srv *memory.Server, handler EchoHandler) error {
	desc := DRPCEchoDescription{}

	// Register with the server/drpc(.Mux).
	err := srv.Router().Register(handler, desc)
	if err != nil {
		return err
	}

	// Add each endpoint name of this handler to the orb drpc server.
	srv.AddEndpoint("/echo.Echo/Echo")

	return nil
}

// registerEchoHTTPHandler registers the service to an HTTP server.
func registerEchoHTTPHandler(srv *mhttp.Server, handler EchoHandler) {
	r := srv.Router()
	r.Post("/echo.Echo/Echo", mhttp.NewGRPCHandler(srv, handler.Echo, HandlerEcho, "Echo"))
}

// RegisterEchoHandler will return a registration function that can be
// provided to entrypoints as a handler registration.
func RegisterEchoHandler(handler EchoHandler) server.RegistrationFunc {
	return func(s any) {
		switch srv := s.(type) {

		case grpc.ServiceRegistrar:
			registerEchoGRPCHandler(srv, handler)
		case *mdrpc.Server:
			registerEchoDRPCHandler(srv, handler)
		case *memory.Server:
			registerEchoMemoryHandler(srv, handler)
		case *mhttp.Server:
			registerEchoHTTPHandler(srv, handler)
		default:
			log.Warn("No provider for this server found", "proto", "echo/echo.proto", "handler", "Echo", "server", s)
		}
	}
}
